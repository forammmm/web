<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smash Wall â€” Glass Explosion (MoodRoom)</title>

  <style>
    :root {
      --bg1: #0b0b0c;
      --panel: rgba(255, 255, 255, 0.03);
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
      background: radial-gradient(circle at 10% 10%, #0a0a0a 0%, #0c0c0c 40%), var(--bg1);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
    }

    .wrap {
      width: 100%;
      max-width: 1100px;
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 24px;
      align-items: start
    }

    .card {
      background: var(--panel);
      padding: 14px;
      border-radius: 14px;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255, 255, 255, 0.03)
    }

    .title {
      font-weight: 800;
      font-size: 20px
    }

    /* WALL */
    .wall-area {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px
    }

    #wall {
      width: 380px;
      height: 560px;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.18)),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="1200"><rect width="100%" height="100%" fill="%23111111"/></svg>') center/cover no-repeat;
      border: 1px solid rgba(255, 255, 255, 0.04);
      box-shadow: 0 18px 60px rgba(255, 20, 20, 0.06);
      transform-origin: center;
      touch-action: manipulation;
    }

    /* slight glow */
    #wall.glow {
      box-shadow: 0 16px 50px rgba(255, 40, 40, 0.16), inset 0 0 140px rgba(255, 10, 10, 0.04);
    }

    /* inline-crack (SVG container) */
    .crack-svg {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: visible;
    }

    .crack {
      position: absolute;
      width: 160px;
      height: 160px;
      pointer-events: none;
      transform-origin: center;
      z-index: 9999;
      animation: crackAppear 180ms cubic-bezier(.2, .9, .2, 1);
      will-change: transform;
    }

    @keyframes crackAppear {
      0% {
        transform: translate(-50%, -50%) scale(0.4) rotate(-6deg);
      }

      100% {
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
      }
    }

    /* HUD / right column */
    .right {
      display: flex;
      flex-direction: column;
      gap: 12px
    }

    .stat {
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .meter {
      height: 16px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      overflow: hidden
    }

    .meter>i {
      display: block;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ff4b4b, #ff8a8a);
      transition: width 140ms linear
    }

    .combo {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.28);
      font-weight: 800
    }

    .controls {
      display: flex;
      gap: 8px
    }

    .btn {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 700
    }

    .btn.primary {
      background: linear-gradient(90deg, #ff4b4b, #ff7b7b);
      color: #140202
    }

    .btn.ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.06);
      color: #fff
    }

    /* shards (explosion pieces) */
    .shard {
      position: absolute;
      width: 10px;
      height: 18px;
      pointer-events: none;
      border-radius: 2px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(220, 220, 220, 0.9));
      transform-origin: center;
      opacity: 0;
      z-index: 9998;
    }

    /* flash overlay for explosion */
    #flash {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0;
      background: radial-gradient(circle at center, rgba(255, 255, 255, 0.95), rgba(255, 120, 120, 0.1));
      mix-blend-mode: screen;
      transition: opacity 220ms ease;
      z-index: 9997;
    }

    @media (max-width:900px) {
      .wrap {
        grid-template-columns: 1fr;
        gap: 12px
      }

      #wall {
        width: 92vw;
        height: 68vh
      }
    }
  </style>
</head>

<body>
  <div id="flash"></div>

  <div class="wrap">
    <div>
      <div class="card" style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="title">Smash Wall â€” Glass Explosion</div>
          <div style="opacity:0.85;font-size:13px;margin-top:6px">Tap or swipe aggressively to release anger. The final
            break triggers a cinematic glass explosion.</div>
        </div>
        <div style="text-align:right">
          <div style="opacity:0.7;font-size:12px">Mood</div>
          <div style="font-weight:800">Anger ðŸ”¥</div>
        </div>
      </div>

      <div class="card wall-area" style="margin-top:16px">
        <div id="wall" title="Tap to smash"></div>
      </div>

      <div style="margin-top:14px;display:flex;gap:10px">
        <button id="fullscreenBtn" class="btn ghost">Fullscreen</button>
        <button id="resetBtn" class="btn primary">Reset Session</button>
      </div>
    </div>

    <div class="right">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <div style="font-weight:800">Live HUD</div>
          <div class="combo" id="comboBox">Combo: x0</div>
        </div>

        <div class="stat">
          <div style="opacity:0.85">Rage Meter</div>
          <div id="meterLabel">0 / 28</div>
        </div>
        <div class="meter" style="margin-bottom:10px"><i id="rageBar" style="width:0%"></i></div>

        <div class="stat">
          <div style="opacity:0.85">Session Hits</div>
          <div id="sessionHits">0</div>
        </div>
        <div class="stat">
          <div style="opacity:0.85">Smash Count</div>
          <div id="smashCount">0</div>
        </div>
        <div class="stat">
          <div style="opacity:0.85">Tip</div>
          <div style="opacity:0.8">Rapid taps fill meter faster</div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div style="font-weight:800;margin-bottom:6px">Controls</div>
        <div style="display:flex;gap:8px">
          <!-- demo & auto removed as requested -->
          <div style="opacity:0.7;font-size:13px">Demo controls removed</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (async function () {
      // DOM
      const wall = document.getElementById('wall');
      const rageBar = document.getElementById('rageBar');
      const meterLabel = document.getElementById('meterLabel');
      const sessionHitsEl = document.getElementById('sessionHits');
      const smashCountEl = document.getElementById('smashCount');
      const comboBox = document.getElementById('comboBox');
      const resetBtn = document.getElementById('resetBtn');
      const fullscreenBtn = document.getElementById('fullscreenBtn');
      const flash = document.getElementById('flash');

      // local state (frontend-only)
      let SMASH_THRESHOLD = 28;
      let sessionHits = 0, combo = 0, smashCount = 0;
      let lastHitAt = 0;
      const COMBO_WINDOW = 1200; // ms
      let disabled = false;

      // WebAudio (robust fallback)
      let audioCtx = null;
      function ensureAudio() {
        try {
          if (!audioCtx) {
            const AC = window.AudioContext || window.webkitAudioContext;
            if (!AC) return null;
            audioCtx = new AC();
          }
          if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(() => { });
          return audioCtx;
        } catch (e) {
          return null;
        }
      }

      function playHitSound() {
        const ctx = ensureAudio();
        if (!ctx) return;
        try {
          const now = ctx.currentTime;
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = 'sine'; // safe waveform
          o.frequency.setValueAtTime(260 + Math.random() * 80, now);
          g.gain.setValueAtTime(0.02, now);
          o.connect(g); g.connect(ctx.destination);
          o.start(now); o.stop(now + 0.06);
        } catch (e) { }
      }

      function playShatterSound() {
        const ctx = ensureAudio();
        if (!ctx) return;
        try {
          const now = ctx.currentTime;
          const o1 = ctx.createOscillator();
          const o2 = ctx.createOscillator();
          const g = ctx.createGain();
          o1.type = 'sine'; o2.type = 'sine';
          o1.frequency.setValueAtTime(700, now);
          o2.frequency.setValueAtTime(410, now);
          g.gain.setValueAtTime(0.0035, now);
          o1.connect(g); o2.connect(g); g.connect(ctx.destination);
          o1.start(now); o2.start(now);
          o1.stop(now + 0.9); o2.stop(now + 0.9);
        } catch (e) { }
      }

      function vibrate(pattern) { if (navigator.vibrate) navigator.vibrate(pattern); }

      // ---------- UI update (local) ----------
      function updateUI() {
        // avoid NaN and negative values
        sessionHits = Math.max(0, Math.floor(sessionHits));
        const pct = Math.min(100, Math.round((sessionHits / SMASH_THRESHOLD) * 100));
        rageBar.style.width = pct + '%';
        meterLabel.textContent = `${sessionHits} / ${SMASH_THRESHOLD}`;
        sessionHitsEl.textContent = sessionHits;
        comboBox.textContent = `Combo: x${combo || 0}`;
        smashCountEl.textContent = smashCount;
      }

      // ---------- create inline SVG crack ----------
      function createCrackAt(clientX, clientY) {
        const rect = wall.getBoundingClientRect();
        const cx = clientX - rect.left;
        const cy = clientY - rect.top;

        const wrapper = document.createElement('div');
        wrapper.className = 'crack';
        wrapper.style.left = cx + 'px';
        wrapper.style.top = cy + 'px';
        wrapper.style.transform = 'translate(-50%,-50%) scale(0.6) rotate(-8deg)';

        const svgns = 'http://www.w3.org/2000/svg';
        const svg = document.createElementNS(svgns, 'svg');
        svg.setAttribute('viewBox', '0 0 200 200');
        svg.setAttribute('width', '100%'); svg.setAttribute('height', '100%');
        svg.setAttribute('aria-hidden', 'true');

        const path = document.createElementNS(svgns, 'path');
        const p = [
          `M ${20 + Math.random() * 30}, ${20 + Math.random() * 40}`,
          `L ${60 + Math.random() * 40}, ${40 + Math.random() * 60}`,
          `L ${90 + Math.random() * 60}, ${90 + Math.random() * 60}`,
          `L ${140 + Math.random() * 40}, ${140 + Math.random() * 40}`
        ].join(' ');
        path.setAttribute('d', p);
        path.setAttribute('stroke', 'rgba(255,255,255,0.9)');
        path.setAttribute('stroke-width', '3');
        path.setAttribute('fill', 'none');
        path.setAttribute('stroke-linecap', 'round');
        path.setAttribute('stroke-linejoin', 'round');
        svg.appendChild(path);

        // a couple of tiny branches
        const branches = 1 + Math.floor(Math.random() * 3);
        for (let i = 0; i < branches; i++) {
          const bx = 50 + Math.random() * 90;
          const by = 50 + Math.random() * 90;
          const bx2 = bx + (Math.random() * 40 - 20);
          const by2 = by + (Math.random() * 40 - 20);
          const b = document.createElementNS(svgns, 'path');
          b.setAttribute('d', `M ${bx} ${by} L ${bx2} ${by2}`);
          b.setAttribute('stroke', 'rgba(255,255,255,0.8)');
          b.setAttribute('stroke-width', '1.2');
          b.setAttribute('fill', 'none');
          b.setAttribute('stroke-linecap', 'round');
          svg.appendChild(b);
        }

        // center dot
        const c = document.createElementNS(svgns, 'circle');
        c.setAttribute('cx', String(92 + Math.random() * 6 - 3));
        c.setAttribute('cy', String(82 + Math.random() * 6 - 3));
        c.setAttribute('r', '2');
        c.setAttribute('fill', 'rgba(255,255,255,0.95)');
        svg.appendChild(c);

        wrapper.appendChild(svg);
        wall.appendChild(wrapper);

        // ensure CSS animation starts
        void wrapper.offsetWidth;

        // remove after animation
        // setTimeout(() => { wrapper && wrapper.remove(); }, 950);
      }

      // ---------- shards explosion ----------
      function explodeGlass() {
        playShatterSound();
        vibrate([40, 30, 60]);
        flash.style.opacity = '1';
        setTimeout(() => { flash.style.opacity = '0'; }, 220);
        document.querySelectorAll('.crack, .shard').forEach(n=>n.remove());

        const rect = wall.getBoundingClientRect();
        const count = 40;
        for (let i = 0; i < count; i++) {
          const s = document.createElement('div');
          s.className = 'shard';
          const w = 6 + Math.random() * 18;
          s.style.width = w + 'px';
          s.style.height = (w * (0.8 + Math.random() * 1.6)) + 'px';
          s.style.left = (Math.random() * rect.width) + 'px';
          s.style.top = (Math.random() * rect.height) + 'px';
          s.style.opacity = 1;
          s.style.transform = `translate(0,0) rotate(${Math.random() * 360}deg)`;
          wall.appendChild(s);

          const dx = (Math.random() - 0.5) * rect.width * 2;
          const dy = (Math.random() - 0.5) * rect.height * 2;
          const rot = (Math.random() - 0.5) * 1080;
          s.style.transition = `transform ${900 + Math.random() * 500}ms cubic-bezier(.1,.8,.2,1), opacity ${900 + Math.random() * 400}ms`;
          requestAnimationFrame(() => {
            s.style.transform = `translate(${dx}px, ${dy}px) rotate(${rot}deg) scale(${0.6 + Math.random() * 1.4})`;
            s.style.opacity = 0;
          });
          setTimeout(() => s.remove(), 1600 + Math.random() * 600);
        }
      }

      // ---------- shake ----------
      function shakeWall() {
        wall.animate([
          { transform: 'translate(0,0) rotate(0deg)' },
          { transform: 'translate(-6px,4px) rotate(-2deg)' },
          { transform: 'translate(6px,-4px) rotate(2deg)' },
          { transform: 'translate(0,0) rotate(0deg)' }
        ], { duration: 140, easing: 'cubic-bezier(.2,.8,.2,1)' });
      }

      // ---------- hit handling (frontend only) ----------
      function registerHit(clientX, clientY) {
        if (disabled) return;

        // visuals
        createCrackAt(clientX, clientY);
        shakeWall();
        playHitSound();
        vibrate(18);

        // combo logic
        const now = Date.now();
        if (lastHitAt && (now - lastHitAt) < COMBO_WINDOW) {
          combo = Math.max(1, combo) + 1;
        } else {
          combo = 1;
        }
        lastHitAt = now;

        // increase session hits
        sessionHits += 1;
        updateUI();

        // final smash
        if (sessionHits >= SMASH_THRESHOLD) {
          disabled = true;
          smashCount += 1;
          updateUI();
          // explosion visuals
          explodeGlass();
          // small scale animation
          wall.animate([{ transform: 'scale(1)' }, { transform: 'scale(0.98)' }], { duration: 380 });
          // reset after cinematic
          setTimeout(() => {
            sessionHits = 0;
            combo = 0;
            lastHitAt = 0;
            updateUI();
            disabled = false;
          }, 900);
        }
      }

      // attach events
      wall.addEventListener('click', (ev) => registerHit(ev.clientX, ev.clientY));
      wall.addEventListener('touchstart', (ev) => {
        const t = ev.touches[0];
        registerHit(t.clientX, t.clientY);
      }, { passive: true });

      // reset (frontend)
      resetBtn.addEventListener('click', () => {
        sessionHits = 0; combo = 0; smashCount = 0; lastHitAt = 0;
        updateUI();
        // remove any remaining cracks/shards
        document.querySelectorAll('.crack, .shard').forEach(n => n.remove());
      });

      // fullscreen
      fullscreenBtn.addEventListener('click', async () => {
        try {
          if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
          else await document.exitFullscreen();
        } catch (e) { }
      });

      // keyboard (space)
      window.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
          const r = wall.getBoundingClientRect();
          registerHit(r.left + r.width / 2, r.top + r.height / 2);
          e.preventDefault();
        }
      });

      // unlock audio on first user gesture (some browsers)
      document.addEventListener('pointerdown', function unlockAudio() {
        ensureAudio();
        document.removeEventListener('pointerdown', unlockAudio);
      }, { once: true });

      // initialize UI
      updateUI();

    })(); // IIFE
  </script>
</body>

</html>